/**
 * Copyright (c), 2012~2021 iot.10086.cn All Rights Reserved
 *
 * @file ringa_tlv.c
 * @brief
 */

/*****************************************************************************/
/* Includes                                                                  */
/*****************************************************************************/
#include "plat_osl.h"

#include "ringa_tlv.h"

/*****************************************************************************/
/* Local Definitions ( Constant and Macro )                                  */
/*****************************************************************************/

/*****************************************************************************/
/* Structures, Enum and Typedefs                                             */
/*****************************************************************************/

/*****************************************************************************/
/* Local Function Prototype                                                  */
/*****************************************************************************/

/*****************************************************************************/
/* Local Variables                                                           */
/*****************************************************************************/

/*****************************************************************************/
/* Global Variables                                                          */
/*****************************************************************************/

/*****************************************************************************/
/* Function Implementation                                                   */
/*****************************************************************************/
uint16_t ringa_tlv_ser(uint8_t *buf, enum ringa_tlv_type_e type, uint8_t *val, uint16_t val_len)
{
    buf[0] = type;
    osl_memcpy(buf + 1, &val_len, 2);
    osl_memcpy(buf + 3, val, val_len);
    return (3 + val_len);
}

uint16_t ringa_tlv_deser(uint8_t *buf, enum ringa_tlv_type_e *type, uint8_t **val, uint16_t *val_len)
{
    uint16_t len = ringa_tlv_get_next_len(buf);

    if (type)
    {
        *type = buf[0];
    }
    if (val_len)
    {
        osl_memcpy(val_len, buf + 1, 2);
    }
    if (val)
    {
        *val = buf + 3;
    }
    return (3 + len);
}

uint16_t ringa_tlv_get_next_len(uint8_t *buf)
{
    return ((buf[2] << 8) | buf[1]);
}
